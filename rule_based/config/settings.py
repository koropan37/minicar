"""
ルールベース走行の設定ファイル
joystick_control/config/settings.py を参考に作成
"""

# ===========================================
# センサー設定 (VL53L4CD)
# ===========================================
# XSHUTピン番号 
# センサー配置: [真左, 斜め左前, 正面, 斜め右前, 真右]
# インデックス:    0       1       2       3        4
XSHUT_PINS = [17, 27, 22, 23, 24]

# センサーI2Cアドレスのベース
SENSOR_BASE_ADDRESS = 0x30

# センサータイミング設定
SENSOR_TIMING_BUDGET = 50
SENSOR_INTER_MEASUREMENT = 60

# センサー無効値 (mm)
SENSOR_INVALID_VALUE = 9999

# ===========================================
# サーボ設定 (ステアリング)
# ===========================================
SERVO_CHANNEL = 0
SERVO_MIN_PULSE = 500
SERVO_MAX_PULSE = 2500

# ステアリング角度（実測値）
SERVO_CENTER = 114  # 真っ直ぐ
SERVO_LEFT = 92     # 左いっぱい
SERVO_RIGHT = 140   # 右いっぱい

# ===========================================
# ESC設定 (モーター)
# ===========================================
ESC_CHANNEL = 1
ESC_MIN_PULSE = 1100
ESC_MAX_PULSE = 2000

# スロットル値（実測値: -1.0 ~ 1.0）
THROTTLE_FORWARD_MIN = 0.23   # 前進最小
THROTTLE_FORWARD_MAX = 0.45   # 前進最大
THROTTLE_BACKWARD_MIN = -0.13 # 後退最小
THROTTLE_BACKWARD_MAX = -0.16 # 後退最大
THROTTLE_NEUTRAL = 0.0        # 停止

# ===========================================
# PCA9685設定
# ===========================================
PCA9685_FREQUENCY = 50

# ===========================================
# 走行制御パラメータ
# ===========================================

# --- 壁沿い走行 (左壁基準) ---
TARGET_WALL_DISTANCE = 100  # 左壁との目標距離 (mm)

# PID制御ゲイン
KP = 0.25   # 比例ゲイン (反応感度)
KD = 0.10   # 微分ゲイン (振動抑制)
KI = 0.00   # 積分ゲイン (定常偏差補正、通常は0でOK)

# --- 距離閾値 (mm) ---
# 緊急停止
EMERGENCY_FRONT_DISTANCE = 100   # 正面がこの距離以下で緊急停止
EMERGENCY_SIDE_DISTANCE = 80     # 側面がこの距離以下で緊急回避

# コーナー検出
CORNER_FRONT_DISTANCE = 150      # 正面がこの距離以下で緊急停止
CORNER_NO_WALL_DISTANCE = 850    # 壁がなくなったと判断する閾値（500→850に変更）
CORNER_WALL_EXIST_DISTANCE = 600 # 壁があると判断する閾値（350→600に変更）

# 直進判定
STRAIGHT_ERROR_THRESHOLD = 40    # この誤差以下なら直進と判断

# --- 速度設定 ---
SPEED_SLOW = 0.28    # 低速 (コーナー、障害物回避)
SPEED_MEDIUM = 0.35  # 中速 (通常走行)
SPEED_FAST = 0.40    # 高速 (直線)

# ===========================================
# 制御周期設定
# ===========================================
CONTROL_INTERVAL = 0.05  # 50ms (20Hz)

# ===========================================
# デバッグ設定
# ===========================================
DEBUG_PRINT_INTERVAL = 5  # N回に1回デバッグ表示
ENABLE_DEBUG_LOG = True   # デバッグログ有効化
