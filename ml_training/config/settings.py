"""
機械学習の設定ファイル

【モデルタイプ一覧】
┌─────────────────┬────────────────────────────────────────────────────────┐
│ モデルタイプ     │ 説明                                                    │
├─────────────────┼────────────────────────────────────────────────────────┤
│ mlp_regressor   │ 多層パーセプトロン（回帰）                               │
│                 │ - 連続値（-1.0〜1.0）を予測                              │
│                 │ - 滑らかなステアリング制御が可能                          │
│                 │ - データ量: 1000件以上推奨                               │
├─────────────────┼────────────────────────────────────────────────────────┤
│ mlp_classifier  │ 多層パーセプトロン（分類）                               │
│                 │ - クラス（左/直進/右など）を予測                          │
│                 │ - シンプルで少ないデータでも動作                          │
│                 │ - データ量: 300件以上推奨                                │
├─────────────────┼────────────────────────────────────────────────────────┤
│ random_forest   │ ランダムフォレスト                                       │
│                 │ - 決定木のアンサンブル学習                               │
│                 │ - 過学習しにくく安定                                     │
│                 │ - ハイパーパラメータ調整が少なくて済む                    │
└─────────────────┴────────────────────────────────────────────────────────┘

【隠れ層（HIDDEN_LAYERS）の目安】
┌─────────────────┬────────────────────────────────────────────────────────┐
│ 設定例           │ 用途                                                    │
├─────────────────┼────────────────────────────────────────────────────────┤
│ (32,)           │ 最小構成、データが少ない時（〜300件）                     │
│ (32, 32)        │ 小規模、シンプルなパターン（300〜500件）                  │
│ (64, 64)        │ 標準的、バランス重視（500〜1500件）                       │
│ (64, 64, 32)    │ 中規模、複雑なパターン対応（1500〜3000件）                │
│ (128, 128, 64)  │ 大規模、高精度狙い（3000件以上）                         │
└─────────────────┴────────────────────────────────────────────────────────┘

【プリセット設定】下記のPRESETを変更することで簡単に切り替え可能
- "small"    : データ少なめ用（分類、小さいネットワーク）
- "medium"   : 標準設定（回帰、中規模ネットワーク）
- "large"    : データ多め用（回帰、大きいネットワーク）
- "custom"   : 下記の個別設定を使用
"""

# ===========================================
# プリセット選択（"small", "medium", "large", "custom"）
# ===========================================
PRESET = "small"

# プリセット定義
_PRESETS = {
    "small": {
        "model_type": "mlp_classifier",
        "hidden_layers": (32, 32),
        "target_columns": ["steering"],
    },
    "medium": {
        "model_type": "mlp_regressor",
        "hidden_layers": (64, 64),
        "target_columns": ["steering", "throttle"],
    },
    "large": {
        "model_type": "mlp_regressor",
        "hidden_layers": (128, 128, 64),
        "target_columns": ["steering", "throttle"],
    },
}

# ===========================================
# データ設定
# ===========================================
RAW_DATA_PATH = "data/raw"
PROCESSED_DATA_PATH = "data/processed"
MODEL_SAVE_PATH = "models"

# CSVカラム
CSV_COLUMNS = ["timestamp", "steering", "throttle", "L2", "L1", "C", "R1", "R2"]
SENSOR_COLUMNS = ["L2", "L1", "C", "R1", "R2"]

# 予測対象カラム（以下から選択）
# - ["steering"]             : ステアリングのみ予測（throttleは固定値で走行）
# - ["throttle"]             : スロットルのみ予測（steeringは別ロジック）
# - ["steering", "throttle"] : 両方予測（マルチ出力）
TARGET_COLUMNS = ["steering", "throttle"]

# ===========================================
# 前処理設定
# ===========================================
# センサー値の有効範囲（mm）
SENSOR_MIN = 0
SENSOR_MAX = 1000
SENSOR_INVALID = 999

# 正規化方法: "standard" (平均0, 標準偏差1) または "minmax" (0-1)
NORMALIZATION = "standard"

# ===========================================
# モデル設定（PRESET="custom"の場合に使用）
# ===========================================
# モデルタイプ: "mlp_classifier", "mlp_regressor", "random_forest"
MODEL_TYPE = "mlp_regressor"

# MLPの隠れ層
HIDDEN_LAYERS = (64, 64, 32)

# 学習パラメータ
MAX_ITER = 2000
RANDOM_STATE = 42
TEST_SIZE = 0.2  # テストデータの割合

# ===========================================
# 分類モデル用設定（mlp_classifierの場合）
# ===========================================
# ステアリングをクラスに変換する閾値
STEER_THRESHOLDS = {
    "hard_left": -0.6,   # -1.0 〜 -0.6
    "left": -0.2,        # -0.6 〜 -0.2
    "straight": 0.2,     # -0.2 〜 0.2
    "right": 0.6,        # 0.2 〜 0.6
    # hard_right は 0.6 〜 1.0
}

# クラス名（0〜4に対応）
CLASS_NAMES = ["hard_left", "left", "straight", "right", "hard_right"]

# ===========================================
# 実車走行用設定（run_ml.py用）
# ===========================================
# スロットル値
THROTTLE_STOP = 0.0
THROTTLE_SLOW = 0.28
THROTTLE_NORMAL = 0.38
THROTTLE_FAST = 0.45

# サーボ角度
SERVO_CENTER = 114
SERVO_LEFT = 92
SERVO_RIGHT = 140

# センサー無効値
SENSOR_INVALID_VALUE = 9999

# ===========================================
# プリセット適用（この部分は変更不要）
# ===========================================
if PRESET in _PRESETS:
    _preset = _PRESETS[PRESET]
    MODEL_TYPE = _preset["model_type"]
    HIDDEN_LAYERS = _preset["hidden_layers"]
    TARGET_COLUMNS = _preset["target_columns"]
